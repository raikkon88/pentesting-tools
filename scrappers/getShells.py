# # Shell collector
# Retrieve all the shells from the page https://www.revshells.com/ in url encoded format
# - Stores the webshells inside a json file at the location from where the script is executed.

import json
from time import sleep
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


def retrieve_reverse_shell():
    shell = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.ID, "reverse-shell-command")))
    return shell.text

def select_terminal(name):
    try:
        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f"//button[text() = '{name}']"))).click()
        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.ID, "encoding"))).click()
        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, "//option[@value='encodeURL']"))).click()
        print(f'-- changed shell to {name} --')
        return retrieve_reverse_shell()
    except: 
        print(f'-< Not found element {name} <-')
    

driver = webdriver.Firefox()
driver.get("https://www.revshells.com/")
sleep(2)
print('-- page loaded --')

try: 

    buttons_query = "//div[@id='reverse-shell-selection']//button"    
    elements = driver.find_elements_by_xpath(buttons_query)

    names = list(map(lambda x: x.text, elements))

    shells = []
    for name in names: 
        print(f'-- Processing terminal {name} --')
        shell = select_terminal(name)
        shells.append({"name": name, "shell": shell})

    with open('./shells.json', "w+") as writter:
        json.dump(shells, writter)

except Exception as e: 
    print(e) 

driver.close()    
